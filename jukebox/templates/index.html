<!doctype html>
<html>
<head>
<title>{{ app_name }}</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Robots" content="NoIndex, NoFollow" />
<link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css" id="Stylesheet_jQueryUI" rel="stylesheet" type="text/css" />
<script id="Script_jQuery" src="//ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js" type="text/javascript"></script>
<script id="Script_jQueryUI" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
<script id="Script_JsRender" src="//cdnjs.cloudflare.com/ajax/libs/jsrender/0.9.75/jsrender.min.js" type="text/javascript"></script>
<script id="main">
// Sort out results.
function fix_links() {
    $(".track-skip").click(function(e) {
        e.preventDefault()
        $.get("/skip")
    }).removeClass("track-skip")
    $(".track-delete").click(function(e) {
        e.preventDefault()
        $.get("/delete_track/" + this.id)
    }).removeClass("track-delete")
    $(".track-queue").click(function(e) {
        e.preventDefault()
        $.get("/queue_track/" + this.id)
    }).removeClass("track-queue")
    $(".track-artist").click(function(e) {
        e.preventDefault()
        $.get("/artist/" + this.id)
    }).removeClass("track-artist")
    $(".track-album").click(function(e) {
        e.preventDefault()
        $.get("/album/" + this.id)
    }).removeClass("track-album")
    $(".playlist-link").click(function(e) {
        e.preventDefault()
        $.get("/playlist/" + this.id)
    }).removeClass("playlist-link")
}

// Old search results.
old_now_playing = null
old_tracks = []
old_artists = []
old_albums = []
old_playlists = []
old_message = null
old_tracks_header = null
old_artist = null
old_album = null
old_playlist = null
old_queue = null

$(document).ready(function () {
    $(".hidden").hide()
    $("#message_button").click(function() {
        $("#message").hide()
    })
    $(".toggle").click(function(e) {
        e.preventDefault()
        $(this.id).toggle()
    })
    $("#search_form").submit(function (e) {
        e.preventDefault()
        search = $("#search").prop("value")
        if (search) {
            $("#search").prop("value", "")
            $.get(encodeURI("/modern_search/" + search))
        } else {
            alert("You must enter something to search for.")
        }
    })
    setInterval(function() {
        $.getJSON("/json", function(data) {
            if (data.message && data.message != old_message) {
                old_message = data.message
                $("#message").show()
                $("#message_content").text(data.message)
            }
            if (data.now_playing != old_now_playing) {
                old_now_playing = data.now_playing
                $("#now_playing").html(data.now_playing)
            }
            if (data.tracks_header != old_tracks_header) {
                old_tracks_header = data.tracks_header
                $("#tracks_header").text(data.tracks_header)
            }
            if (data.tracks != old_tracks) {
                old_tracks = data.tracks
                $("#track_results").html(data.tracks)
            }
            if (data.artists != old_artists) {
                old_artists = data.artists
                $("#artist_results").html(data.artists)
            }
            if (data.albums != old_albums) {
                old_albums = data.albums
                $("#album_results").html(data.albums)
            }
            if (data.playlists != old_playlists) {
                old_playlists = data.playlists
                $("#playlist_results").html(data.playlists)
            }
            if (data.artist != old_artist) {
                if (data.artist) {
                    old_artist = data.artist
                    $("#artist-content").html(data.artist)
                    $("#artist").show()
                } else {
                    $("#artist").hide()
                }
            }
            if (data.album != old_album) {
                if (data.album) {
                    old_album = data.album
                    $("#album-content").html(data.album)
                    $("#album").show()
                } else {
                    $("#album").hide()
                }
            }
            if (data.playlist != old_playlist) {
                if (data.playlist) {
                    old_playlist = data.playlist
                    $("#playlist-content").html(data.playlist)
                    $("#playlist").show()
                } else {
                    $("#playlist").hide()
                }
            }
            if (data.queue != old_queue) {
                old_queue = data.queue
                $("#track_queue").html(data.queue)
            }
        fix_links()
        })
    }, 1000)
})
</script>
</head>
<body>
<h1>Welcome to the jukebox</h1>
<p>Visit the <a href="/">simple</a> web interface.</p>
<div class="hidden" id="message">
<h1>Message</h1>
<p id="message_content">No message yet.</p>
<p><input type="button" id="message_button" value="OK"></p>
</div>
<div id="now_playing">Loading...</div>
<hr>
{% for id in ['artist', 'album', 'playlist'] %}
<div class="hidden" id="{{ id }}">
<h3>{{ id|title }}</h3>
<div id="{{ id }}-content"></div>
</div>
{% endfor %}
<h1>Search</h1>
<form id="search_form">
<p>Search: {{ form.search }}</p>
<p><input type="submit" value="Search"></p>
</form>
<h2><a class="toggle" id="#track_results" href="#"><div id="tracks_header">Loading...</div></a></h2>
<div id="track_results">Loading...</div>
<h2><a class="toggle" id="#artist_results" href="#"><div>Artist Results</div></a></h2>
<div id="artist_results">Loading...</div>
<h2><a class="toggle" id="#album_results" href="#"><div>Album Results</div></a></h2>
<div id="album_results">Loading...</div>
<h2><a class="toggle" id="#playlist_results"><div>Playlist Results</div></a></h2>
<div id="playlist_results">Loading...</div>
<h2><a class="toggle" id="#track_queue" href="#"><div>Play Queue</div></a></h2>
<div class="hidden" id="track_queue">Loading...</div>
</body>
</html>
